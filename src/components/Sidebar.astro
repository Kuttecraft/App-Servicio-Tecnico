---
type Perfil = {
  rol?: string;
  admin?: boolean | string | 0 | 1;
  tickets?: boolean | string | 0 | 1;
  usuarios?: boolean | string | 0 | 1;
  estadisticas?: boolean | string | 0 | 1;
};

const { mobile = false, perfil = {} as Perfil } = Astro.props;

const isTrue = (val: any) =>
  val === true || val === 'true' || val === 1 || val === '1';

const esAdmin = isTrue((perfil as any)?.admin) || perfil?.rol === 'admin';

/* ❗ Tickets ahora es SOLO para admins */
const veTickets = esAdmin;

/* Usuarios / Estadísticas SOLO admin también */
const veUsuarios = esAdmin;
const veEstadisticas = esAdmin;
---

{!mobile ? (
  <aside class="d-none d-md-flex flex-column bg-dark text-white p-3"
    style="position: fixed; top: 0; left: 0; height: 100vh; width: 240px; z-index: 1030;">
    <h4 class="text-center mb-4">Servicio Técnico</h4>
    <nav class="nav nav-pills flex-column gap-2">
      <a class="nav-link text-white d-flex align-items-center gap-2" href="/dashboard">
        <i class="bi bi-house"></i> Inicio
      </a>

      {veTickets && (
        <a class="nav-link text-white d-flex align-items-center gap-2" href="/addTicket">
          <i class="bi bi-ticket-detailed"></i> Tickets
        </a>
      )}

      {veUsuarios && (
        <a class="nav-link text-white d-flex align-items-center gap-2" href="/usuarios">
          <i class="bi bi-people"></i> Usuarios
        </a>
      )}

      {veEstadisticas && (
        <a class="nav-link text-white d-flex align-items-center gap-2" href="/estadisticas">
          <i class="bi bi-bar-chart-line"></i> Estadísticas
        </a>
      )}
    </nav>
  </aside>
) : (
  <div class="offcanvas offcanvas-start bg-dark text-white" tabindex="-1" id="mobileSidebar" aria-labelledby="mobileSidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileSidebarLabel">Menú</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <a class="nav-link text-white mb-2 d-flex align-items-center gap-2" href="/dashboard">
        <i class="bi bi-house"></i> Inicio
      </a>

      {veTickets && (
        <a class="nav-link text-white mb-2 d-flex align-items-center gap-2" href="/addTicket">
          <i class="bi bi-ticket-detailed"></i> Tickets
        </a>
      )}

      {veUsuarios && (
        <a class="nav-link text-white mb-2 d-flex align-items-center gap-2" href="/usuarios">
          <i class="bi bi-people"></i> Usuarios
        </a>
      )}

      {veEstadisticas && (
        <a class="nav-link text-white mb-2 d-flex align-items-center gap-2" href="/estadisticas">
          <i class="bi bi-bar-chart-line"></i> Estadísticas
        </a>
      )}
    </div>
  </div>
)}
